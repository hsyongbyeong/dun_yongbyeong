<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <title>Title</title>
    <script>
        /*
        *
        *
        *
        *
        * */
    </script>
    <style>
        input {
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            /*border: none;*/
        }

        body > div {
            /*border: 1px solid black;*/
            margin-bottom: 3px;
            width: 1200px;
            height: 30px;
        }

        .header {
            display: flex;
            /*width: 1200px;*/
        }
        .header>*{
            margin-right: 5px;
        }

        #tab {
            display: flex;
            overflow: auto;
            height: 100%;
        }

        .tab_if{background-color: #EDEDED;}
        .tab_kj{background-color: #FCE4D6;}
        .tab_uk{background-color: #DDEBF7;}
        .tab_mb{background-color: #E2EFDA;}
        .tab_av{background-color: #9966FF;}
        .tab_cr{background-color: #9966FF;}
        .tab_bg{background-color: #FF66CC;}
        .tab_sp{background-color: #FFCCCC;}

        .tab_row {
            height: 50px;
            width: 100px;
            margin: 0px 2px 0px 2px;
        }

        .tab_btn {
            height: 45px;
            width: inherit;
            border-color: #EDEDED;
            font-weight: bold;
        }
        .tab_btn:hover{
            background-color: cornsilk;
        }

        #contents01 {
            /*width: 1200px;*/
            display: grid;
            grid-auto-flow: column;
            /*grid-auto-columns: minmax(100px, auto);*/
            overflow: auto;
            height: 800px;
            justify-content: start;
        }

        .tb_col {
            display: grid;
            /*width: 120px;*/
            background-color: #ffffff;
        }

        .tb_header {
            border: 1px solid #ededed;
            height: 30px;
            text-align: center;
            width: 100%;
            position: sticky;
            top: 0;
            background-color: cadetblue;
        }
        .tb_body{
            border: 1px solid #ededed;
            height: 90px;
            text-align: center;
            width: 100%;
        }
        .tb_body:nth-child(2n+1){
            background-color: #dcdcdc;
        }

        .GRP_FX_A{
            position: sticky;
            left: 0;
        }

        #contents01>div{
            min-width: 120px;
        }

        .GRP_IF_JOB, .GRP_IF_CODE{
            text-align: left;
        }
        .GRP_UK_A, .GRP_UK_B{
            width: 350px;
        }

        .GRP_MB_A, .GRP_MB_B{
            width: 430px;
        }

        .GRP_AV_A{
            width: 430px;
        }

        .GRP_CR_A{
            width: 350px;
        }

        .GRP_BG_A{
            width: 430px;
        }

    </style>
    <script>
        function init(){

            document.getElementById("ipbApikey").value = "DU248VnsiGXAMbUiNE5P6U1DOdMgncd1";
            onclick_tab('GRP_IF', 'A');
        }
        /////////////////////공통부분//////////////
        var serverList = [
               {
                "serverId": "cain",
                "serverName": "카인"
            }, {
                "serverId": "diregie",
                "serverName": "디레지에"
            }, {
                "serverId": "siroco",
                "serverName": "시로코"
            }, {
                "serverId": "prey",
                "serverName": "프레이"
            }, {
                "serverId": "casillas",
                "serverName": "카시야스"
            }, {
                "serverId": "hilder",
                "serverName": "힐더"
            }, {
                "serverId": "anton",
                "serverName": "안톤"
            }, {
                "serverId": "bakal",
                "serverName": "바칼"
            }
        ];

        //서버한글 -> 영문명으로 변환
        function transServer(seq, serverName) {
            var a1 = serverList.filter(data => data["serverName"] == serverName);
            var res = a1[0].serverId;
            return res;
        }

        //탭구분배열
        //input : GRP_KJ
        //output : [GRP_KJ_WEAPON, GRP_KJ_JACKET, GRP_KJ_SHOULDER, ...]
        function getContentsId(id){
            var contentsArry = document.getElementById("contents01").children;
            var resArry = new Array();
            for(var i = 0; i < contentsArry.length; i++){
                var a1 = contentsArry[i].getAttribute('id');
                if(a1.startsWith(id)){
                    resArry.push(a1);
                }
            }
            return resArry;
        }

        //input : GRP_KJ_WEAPON
        //output :  [GRP_KJ_WEAPON_1, GRP_KJ_WEAPON_2, GRP_KJ_WEAPON_3, ...]
        function setChildren(seq, id, txt){
            var a1 = document.getElementById(id).children;
            a1[seq].innerHTML = txt;
        }

        /*
        * obj :
        * optK : 조건key값
        * optV : 조건value값
        * resK : 결과key값
        * */
        function findTxt(obj, optK, optV, resK){
            try{
                var a1 = obj.filter(data => data[optK] == optV);
                var resV = a1[0][resK];
            }catch (e){
                resV = "";
            }
            return resV;
        }

        /*
        * opt1 : 힘지체정           amplificationName
        * opt2 : 강화or증폭 수치     reinforce
        * */
        function mkReinforce(amplificationName, reinforce){
            var res = "";

            if(amplificationName == null){
                //강화
                res += "<br>";
                res += reinforce + "강";
            }else if(amplificationName != null){
                //증폭
                // res += amplificationName.slice(4, 5) + " " + reinforce + "증";
                res += amplificationName + "<br>" + reinforce + "증";
            }

            return res;
        }

        /**
         *
         * @param fusionOption  각인
         * @param upgradeInfo   융합석명
         */
        function mkFusion(fusionOption, upgradeInfo){
            var res = "";
            var tmp = "";
            var optArry = new Array();

            if(upgradeInfo != null){
                res += upgradeInfo.itemName;
                res += "<br>";
            }


            if(fusionOption != null){
                var options = fusionOption.options;
                res += "[";
                for(var i = 0; i < options.length; i++){
                    if(options[i].hasOwnProperty("engrave")){
                        tmp = options[i].engrave;
                        optArry[i] = tmp.value;
                    }else{
                        optArry[i] = 0;
                    }
                    res += optArry[i];
                    if(i != Number(options.length-1)){
                        res += "/";
                    }
                }
                res +=  "]";
            }
            return res;
        }

        /**
         *
         * @param enchant  마법부여obj
         */
        function mkEnchant(enchant){
            var res = "";
            var tmp = "";
            var optArry = new Array();

            // status - 스텟
            // reinforceSkill 강화스킬
            if(enchant.hasOwnProperty("status")){
                var statusArry = enchant.status;
                for(var i = 0; i < statusArry.length; i++){
                    res += statusArry[i].name + statusArry[i].value;
                    if(i != Number(statusArry.length - 1)){
                        res += "/";
                    }
                }
            }
            res += "<br>";

            if(enchant.hasOwnProperty("reinforceSkill")){
                var reinforceSkillArry = enchant.reinforceSkill;
                // console.log("reinforceSkillArry : " + reinforceSkillArry);
                for(var i = 0; i < reinforceSkillArry.length; i++){
                    var skills = reinforceSkillArry[i].skills;
                    for(var j = 0; j < skills.length; j++){
                        res += skills[j].name + "+" +skills[j].value;
                    }
                    if(i != reinforceSkillArry.length - 1){
                        res += "/";
                    }
                }
            }

            return res;
        }

        function mkAvatar(itemName, optionAbility, emblems){
            var res = "";
            var tmp = new Array();
            if(itemName != null){
                //res += itemName;
            }
            // res += "<br>";
            if(optionAbility != null){
                res += optionAbility;
            }
            res += "<br>";
            if(emblems != null) {
                for (var i = 0; i < emblems.length; i++) {
                    res += emblems[i].itemName;
                    res += "<br>";
                }
            }
            return res;
        }

        function mkCreature(artifact, itemRarity){
            var res = "";
            res += "[" + itemRarity + "]"
            res += "<br>";
            res += artifact;
            return res;
        }

        function mkBuffA(itemName, itemRarity, enchant){
            if(itemName == ""){
                return null;
            }
            var res = "";
            res += "[" + itemRarity + "]";
            res += "<br>";
            res += itemName;
            res += "<br>";
            if(enchant != null){
                var a1 = enchant.reinforceSkill;

                var b1 = "";
                for(var i = 0; i < a1.length; i++){
                    b1 = a1[i].skills;
                    for(var j = 0; j < b1.length; j++){
                        res += b1[j].name + "+" + b1[j].value;
                    }

                }
            }
            return res;
        }

        function mkBuffB(emblems, optionAbility, buffName){
            var res = "";
            if(optionAbility != null){
                res += optionAbility;
            }
            res += "<br>";
            if(emblems != null){
                for(var i = 0; i < emblems.length; i++){
                    if(emblems[i].itemName.includes(buffName)){
                        res += emblems[i].itemName;
                    }
                }
            }
            return res;
        }

        function mkBuffC(skill){
            var res = "";
            var a1 = skill.buff;
            var b1 = a1.creature;

            for(var i = 0; i < b1.length; i++){
                res += b1[i].itemName;
                res += "<br>";
                if(b1[i].enchant != null){
                    res += b1[i].enchant;
                }
            }
            return res;
        }

        /////////////////////////////////////////


        //탭 선택
        function onclick_tab(id, opt){
            var contentsArry = document.getElementById("contents01").children;
            for(var i = 0; i < contentsArry.length; i++){
                var a1 = contentsArry[i].getAttribute('id');
                if(a1.startsWith("GRP_FX_")){
                    continue;
                }
                document.getElementById(a1).style.display = "none";
            }
            //document.getElementById("GRP_SM_SAMPLE").style.display = "block";

            var visibleArry = document.getElementsByClassName(id + "_" + opt);
            for(var i = 0; i < visibleArry.length; i++){
                document.getElementById(visibleArry[i].getAttribute('id')).style.display = "block";
            }
        }

        //헤더의 추가버튼클릭 - 캐릭터 및 그리드 세팅
        function onclick_add(){
            //apikey
            var apikey = document.getElementById("ipbApikey").value;
            //캐릭터 배열
            var charNmArry = document.getElementById("ipbCharNm").value.split(" ");

            var cmbServer = document.getElementById("cmbServer");
            //서버 value
            var serverId = cmbServer.value;
            //서버 label
            var serverName = cmbServer.options[cmbServer.selectedIndex].text;

            if(apikey == ""){
                alert("apikey를 입력해주세요!");
                document.getElementById("ipbApikey").focus();
                return 0;
            }

            if(charNmArry == ""){
                alert("캐릭터명을 입력해주세요!");
                document.getElementById("ipbCharNm").focus();
                return 0;
            }
            //컨텐츠 배열
            var contentsArry = document.getElementById("contents01").children;

            //그리드 생성전 개수
            var seq = document.getElementById("GRP_FX_SEQ").children.length;

            //그리드 생성
            for(var i = 0; i < charNmArry.length; i++){
                for(var j = 0; j < contentsArry.length; j++){
                    var a1 = contentsArry[j].getAttribute('id');
                    var txt = "";

                    txt += '<div class=\"tb_body ' + a1 + '\" id=' + a1 + '_' + seq + ' >';
                    if(a1 == "GRP_FX_SEQ"){
                        txt += seq;
                    }
                    if(a1 == "GRP_FX_SERVER"){
                        txt += serverName;
                    }
                    if(a1 == "GRP_FX_CHARNM"){
                        txt += charNmArry[i];
                    }
                    txt += '</div>';
                    document.getElementById(a1).insertAdjacentHTML('beforeend', txt);
                }
                seq++;
            }
        }

        //조회버튼 클릭
        function onclick_doSearch(){
            var a1 = document.getElementById("GRP_FX_SEQ").children;
            var b1 = document.getElementById("GRP_FX_SERVER").children;
            var c1 = document.getElementById("GRP_FX_CHARNM").children;

            //row개수 구해서 for문 돌리기
            for(var i = 0; i < a1.length; i++){
                if(i == 0){
                    continue;
                }
                var seq = i;
                var serverName = b1[i].innerHTML;
                var characterName = c1[i].innerHTML;

                searchGRP_IF(seq, serverName, characterName);
            }
        }

        /* 기본정보 조회
         * seq : 순번
         * serverName : 서버명 ex) 프레이
         * characterName : 캐릭터명 ex) 버프팜~
         * opt : 구분자
         */
        function searchGRP_IF(seq, serverName, characterName, opt){
            var url = "https://api.neople.co.kr/df/servers/";
                url += transServer(seq, serverName);
                url += "/characters?characterName=";
                url += encodeURIComponent(characterName);
                url += "&apikey=";
                url += document.getElementById("ipbApikey").value;

            var request = new XMLHttpRequest();
            request.open('GET', url, true);
            request.send();
            request.onload = function () {
                var a1 = JSON.parse(request.response);
                //직업
                var jobGrowName = a1.rows[0].jobGrowName;
                //명성
                var fame = a1.rows[0].fame;
                //고유코드
                var characterId = a1.rows[0].characterId;

                setChildren(seq, "GRP_IF_JOB", jobGrowName);
                setChildren(seq, "GRP_IF_FAME", fame);
                setChildren(seq, "GRP_IF_CODE", characterId);

                searchEquipment(seq, serverName, characterId, opt);
            }
        }

        /* 장착장비 조회 -강화/증폭, 융합석[각인], 마법부여
         * seq : 순번
         * serverName : 서버명 ex) 프레이
         * characterId : 캐릭터고유코드 ex) 06cac447998772~~~~~
         * opt : 구분자
         */
        function searchEquipment(seq, serverName, characterId, opt){
            var url = "https://api.neople.co.kr/df/servers/";
                url += transServer(seq, serverName);
                url += "/characters/";
                url += characterId;
                url += "/equip/equipment?apikey=";
                url += document.getElementById("ipbApikey").value;

            var request = new XMLHttpRequest();
            request.open('GET', url, true);
            request.send();
            request.onload = function () {
                var a1 = JSON.parse(request.response);
                var b1 = a1.equipment;

                //강화증폭
                setChildren(seq, "GRP_KJ_WEAPON",       mkReinforce(findTxt(b1, "slotId", "WEAPON",     "amplificationName"), findTxt(b1, "slotId", "WEAPON",       "reinforce")));
                setChildren(seq, "GRP_KJ_JACKET",       mkReinforce(findTxt(b1, "slotId", "JACKET",     "amplificationName"), findTxt(b1, "slotId", "JACKET",       "reinforce")));
                setChildren(seq, "GRP_KJ_SHOULDER",     mkReinforce(findTxt(b1, "slotId", "SHOULDER",   "amplificationName"), findTxt(b1, "slotId", "SHOULDER",     "reinforce")));
                setChildren(seq, "GRP_KJ_PANTS",        mkReinforce(findTxt(b1, "slotId", "PANTS",      "amplificationName"), findTxt(b1, "slotId", "PANTS",        "reinforce")));
                setChildren(seq, "GRP_KJ_SHOES",        mkReinforce(findTxt(b1, "slotId", "SHOES",      "amplificationName"), findTxt(b1, "slotId", "SHOES",        "reinforce")));
                setChildren(seq, "GRP_KJ_WAIST",        mkReinforce(findTxt(b1, "slotId", "WAIST",      "amplificationName"), findTxt(b1, "slotId", "WAIST",        "reinforce")));
                setChildren(seq, "GRP_KJ_AMULET",       mkReinforce(findTxt(b1, "slotId", "AMULET",     "amplificationName"), findTxt(b1, "slotId", "AMULET",       "reinforce")));
                setChildren(seq, "GRP_KJ_WRIST",        mkReinforce(findTxt(b1, "slotId", "WRIST",      "amplificationName"), findTxt(b1, "slotId", "WRIST",        "reinforce")));
                setChildren(seq, "GRP_KJ_RING",         mkReinforce(findTxt(b1, "slotId", "RING",       "amplificationName"), findTxt(b1, "slotId", "RING",         "reinforce")));
                setChildren(seq, "GRP_KJ_SUPPORT",      mkReinforce(findTxt(b1, "slotId", "SUPPORT",    "amplificationName"), findTxt(b1, "slotId", "SUPPORT",      "reinforce")));
                setChildren(seq, "GRP_KJ_MAGIC_STON",   mkReinforce(findTxt(b1, "slotId", "MAGIC_STON", "amplificationName"), findTxt(b1, "slotId", "MAGIC_STON",   "reinforce")));
                setChildren(seq, "GRP_KJ_EARRING",      mkReinforce(findTxt(b1, "slotId", "EARRING",    "amplificationName"), findTxt(b1, "slotId", "EARRING",      "reinforce")));

                //융합석
                setChildren(seq, "GRP_UK_WEAPON",       mkFusion(findTxt(b1, "slotId", "WEAPON",     "fusionOption"), findTxt(b1, "slotId", "WEAPON",       "upgradeInfo")));
                setChildren(seq, "GRP_UK_JACKET",       mkFusion(findTxt(b1, "slotId", "JACKET",     "fusionOption"), findTxt(b1, "slotId", "JACKET",       "upgradeInfo")));
                setChildren(seq, "GRP_UK_SHOULDER",     mkFusion(findTxt(b1, "slotId", "SHOULDER",   "fusionOption"), findTxt(b1, "slotId", "SHOULDER",     "upgradeInfo")));
                setChildren(seq, "GRP_UK_PANTS",        mkFusion(findTxt(b1, "slotId", "PANTS",      "fusionOption"), findTxt(b1, "slotId", "PANTS",        "upgradeInfo")));
                setChildren(seq, "GRP_UK_SHOES",        mkFusion(findTxt(b1, "slotId", "SHOES",      "fusionOption"), findTxt(b1, "slotId", "SHOES",        "upgradeInfo")));
                setChildren(seq, "GRP_UK_WAIST",        mkFusion(findTxt(b1, "slotId", "WAIST",      "fusionOption"), findTxt(b1, "slotId", "WAIST",        "upgradeInfo")));
                setChildren(seq, "GRP_UK_AMULET",       mkFusion(findTxt(b1, "slotId", "AMULET",     "fusionOption"), findTxt(b1, "slotId", "AMULET",       "upgradeInfo")));
                setChildren(seq, "GRP_UK_WRIST",        mkFusion(findTxt(b1, "slotId", "WRIST",      "fusionOption"), findTxt(b1, "slotId", "WRIST",        "upgradeInfo")));
                setChildren(seq, "GRP_UK_RING",         mkFusion(findTxt(b1, "slotId", "RING",       "fusionOption"), findTxt(b1, "slotId", "RING",         "upgradeInfo")));
                setChildren(seq, "GRP_UK_SUPPORT",      mkFusion(findTxt(b1, "slotId", "SUPPORT",    "fusionOption"), findTxt(b1, "slotId", "SUPPORT",      "upgradeInfo")));
                setChildren(seq, "GRP_UK_MAGIC_STON",   mkFusion(findTxt(b1, "slotId", "MAGIC_STON", "fusionOption"), findTxt(b1, "slotId", "MAGIC_STON",   "upgradeInfo")));
                setChildren(seq, "GRP_UK_EARRING",      mkFusion(findTxt(b1, "slotId", "EARRING",    "fusionOption"), findTxt(b1, "slotId", "EARRING",      "upgradeInfo")));

                //마법부여
                setChildren(seq, "GRP_MB_TITLE",        mkEnchant(findTxt(b1, "slotId", "TITLE",      "enchant")));
                setChildren(seq, "GRP_MB_WEAPON",       mkEnchant(findTxt(b1, "slotId", "WEAPON",     "enchant")));
                setChildren(seq, "GRP_MB_JACKET",       mkEnchant(findTxt(b1, "slotId", "JACKET",     "enchant")));
                setChildren(seq, "GRP_MB_SHOULDER",     mkEnchant(findTxt(b1, "slotId", "SHOULDER",   "enchant")));
                setChildren(seq, "GRP_MB_PANTS",        mkEnchant(findTxt(b1, "slotId", "PANTS",      "enchant")));
                setChildren(seq, "GRP_MB_SHOES",        mkEnchant(findTxt(b1, "slotId", "SHOES",      "enchant")));
                setChildren(seq, "GRP_MB_WAIST",        mkEnchant(findTxt(b1, "slotId", "WAIST",      "enchant")));
                setChildren(seq, "GRP_MB_AMULET",       mkEnchant(findTxt(b1, "slotId", "AMULET",     "enchant")));
                setChildren(seq, "GRP_MB_WRIST",        mkEnchant(findTxt(b1, "slotId", "WRIST",      "enchant")));
                setChildren(seq, "GRP_MB_RING",         mkEnchant(findTxt(b1, "slotId", "RING",       "enchant")));
                setChildren(seq, "GRP_MB_SUPPORT",      mkEnchant(findTxt(b1, "slotId", "SUPPORT",    "enchant")));
                setChildren(seq, "GRP_MB_MAGIC_STON",   mkEnchant(findTxt(b1, "slotId", "MAGIC_STON", "enchant")));
                setChildren(seq, "GRP_MB_EARRING",      mkEnchant(findTxt(b1, "slotId", "EARRING",    "enchant")));

                //아바타검색
                searchAvatar(seq, serverName, characterId, opt);
            }
        }

        function searchAvatar(seq, serverName, characterId, opt){
            var url = "https://api.neople.co.kr/df/servers/";
                url += transServer(seq, serverName);
                url += "/characters/";
                url += characterId;
                url += "/equip/avatar?apikey=";
                url += document.getElementById("ipbApikey").value;

            var request = new XMLHttpRequest();
            request.open('GET', url, true);
            request.send();
            request.onload = function () {
                var a1 = JSON.parse(request.response);
                var b1 = a1.avatar;
                //itemName": "레어 모자 클론 아바타"
                //optionAbility": "캐스팅 속도 14.0% 증가"
                //emblems[n] - "itemName": "화려한 그린 엠블렘[체력]", "itemName": "플래티넘 엠블렘[수호의 은총]"
                setChildren(seq, "GRP_AV_HEADGEAR",     mkAvatar(findTxt(b1, "slotId", "HEADGEAR",  "itemName"), findTxt(b1, "slotId", "HEADGEAR",  "optionAbility"), findTxt(b1, "slotId", "HEADGEAR",  "emblems")));
                setChildren(seq, "GRP_AV_HAIR",         mkAvatar(findTxt(b1, "slotId", "HAIR",      "itemName"), findTxt(b1, "slotId", "HAIR",      "optionAbility"), findTxt(b1, "slotId", "HAIR",      "emblems")));
                setChildren(seq, "GRP_AV_FACE",         mkAvatar(findTxt(b1, "slotId", "FACE",      "itemName"), findTxt(b1, "slotId", "FACE",      "optionAbility"), findTxt(b1, "slotId", "FACE",      "emblems")));
                setChildren(seq, "GRP_AV_JACKET",       mkAvatar(findTxt(b1, "slotId", "JACKET",    "itemName"), findTxt(b1, "slotId", "JACKET",    "optionAbility"), findTxt(b1, "slotId", "JACKET",    "emblems")));
                setChildren(seq, "GRP_AV_PANTS",        mkAvatar(findTxt(b1, "slotId", "PANTS",     "itemName"), findTxt(b1, "slotId", "PANTS",     "optionAbility"), findTxt(b1, "slotId", "PANTS",     "emblems")));
                setChildren(seq, "GRP_AV_SHOES",        mkAvatar(findTxt(b1, "slotId", "SHOES",     "itemName"), findTxt(b1, "slotId", "SHOES",     "optionAbility"), findTxt(b1, "slotId", "SHOES",     "emblems")));
                setChildren(seq, "GRP_AV_BREAST",       mkAvatar(findTxt(b1, "slotId", "BREAST",    "itemName"), findTxt(b1, "slotId", "BREAST",    "optionAbility"), findTxt(b1, "slotId", "BREAST",    "emblems")));
                setChildren(seq, "GRP_AV_WAIST",        mkAvatar(findTxt(b1, "slotId", "WAIST",     "itemName"), findTxt(b1, "slotId", "WAIST",     "optionAbility"), findTxt(b1, "slotId", "WAIST",     "emblems")));
                setChildren(seq, "GRP_AV_SKIN",         mkAvatar(findTxt(b1, "slotId", "SKIN",      "itemName"), findTxt(b1, "slotId", "SKIN",      "optionAbility"), findTxt(b1, "slotId", "SKIN",      "emblems")));
                setChildren(seq, "GRP_AV_AURORA",       mkAvatar(findTxt(b1, "slotId", "AURORA",    "itemName"), findTxt(b1, "slotId", "AURORA",    "optionAbility"), findTxt(b1, "slotId", "AURORA",    "emblems")));
                setChildren(seq, "GRP_AV_WEAPON",       mkAvatar(findTxt(b1, "slotId", "WEAPON",    "itemName"), findTxt(b1, "slotId", "WEAPON",    "optionAbility"), findTxt(b1, "slotId", "WEAPON",    "emblems")));
                setChildren(seq, "GRP_AV_AURA_SKIN",    mkAvatar(findTxt(b1, "slotId", "AURA_SKIN", "itemName"), findTxt(b1, "slotId", "AURA_SKIN", "optionAbility"), findTxt(b1, "slotId", "AURA_SKIN", "emblems")));

                //아바타검색
                searchCreature(seq, serverName, characterId, opt);
            }

            function searchCreature(seq, serverName, characterId, opt){
                var url = "https://api.neople.co.kr/df/servers/";
                url += transServer(seq, serverName);
                url += "/characters/";
                url += characterId;
                url += "/equip/creature?apikey=";
                url += document.getElementById("ipbApikey").value;

                var request = new XMLHttpRequest();
                request.open('GET', url, true);
                request.send();
                request.onload = function () {
                    var a1 = JSON.parse(request.response);
                    var b1 = a1.creature;

                    var c1 = b1.artifact;
                    var c2 = b1.clone;

                    setChildren(seq, "GRP_CR_CREATURE",             b1.itemName);
                    setChildren(seq, "GRP_CR_RED_ARTIFACT",         mkCreature(findTxt(c1, "slotColor", "RED",      "itemName"), findTxt(c1, "slotColor", "RED",      "itemRarity")));
                    setChildren(seq, "GRP_CR_BLUE_ARTIFACT",        mkCreature(findTxt(c1, "slotColor", "BLUE",     "itemName"), findTxt(c1, "slotColor", "BLUE",     "itemRarity")));
                    setChildren(seq, "GRP_CR_GREEN_ARTIFACT",       mkCreature(findTxt(c1, "slotColor", "GREEN",    "itemName"), findTxt(c1, "slotColor", "GREEN",    "itemRarity")));
                    setChildren(seq, "GRP_CR_CREATURE_CLONE",       c2.itemName);

                    searchBuffA(seq, serverName, characterId, opt);
                }
            }
        }

        function searchBuffA(seq, serverName, characterId, opt){
            //A.버프스킬강화장착장비
            //B.버프스킬강화장착아바타
            //C.버프스킬강화크리쳐
            var url = "https://api.neople.co.kr/df/servers/";
            url += transServer(seq, serverName);
            url += "/characters/";
            url += characterId;
            url += "/skill/buff/equip/equipment?apikey=";
            url += document.getElementById("ipbApikey").value;

            var request = new XMLHttpRequest();
            request.open('GET', url, true);
            request.send();
            request.onload = function () {
                var a1 = JSON.parse(request.response);
                var b1 = a1.skill;
                var c1 = b1.buff;
                var d1 = c1.equipment;

                setChildren(seq, "GRP_BG_TITLE",        mkBuffA(findTxt(d1, "slotId", "TITLE",      "itemName"), findTxt(d1, "slotId", "TITLE",        "itemRarity"), findTxt(d1, "slotId", "TITLE",        "enchant")));
                setChildren(seq, "GRP_BG_WEAPON",       mkBuffA(findTxt(d1, "slotId", "WEAPON",     "itemName"), findTxt(d1, "slotId", "WEAPON",       "itemRarity")));
                setChildren(seq, "GRP_BG_JACKET",       mkBuffA(findTxt(d1, "slotId", "JACKET",     "itemName"), findTxt(d1, "slotId", "JACKET",       "itemRarity")));
                setChildren(seq, "GRP_BG_SHOULDER",     mkBuffA(findTxt(d1, "slotId", "SHOULDER",   "itemName"), findTxt(d1, "slotId", "SHOULDER",     "itemRarity")));
                setChildren(seq, "GRP_BG_PANTS",        mkBuffA(findTxt(d1, "slotId", "PANTS",      "itemName"), findTxt(d1, "slotId", "PANTS",        "itemRarity")));
                setChildren(seq, "GRP_BG_SHOES",        mkBuffA(findTxt(d1, "slotId", "SHOES",      "itemName"), findTxt(d1, "slotId", "SHOES",        "itemRarity")));
                setChildren(seq, "GRP_BG_WAIST",        mkBuffA(findTxt(d1, "slotId", "WAIST",      "itemName"), findTxt(d1, "slotId", "WAIST",        "itemRarity")));
                setChildren(seq, "GRP_BG_AMULET",       mkBuffA(findTxt(d1, "slotId", "AMULET",     "itemName"), findTxt(d1, "slotId", "AMULET",       "itemRarity")));
                setChildren(seq, "GRP_BG_WRIST",        mkBuffA(findTxt(d1, "slotId", "WRIST",      "itemName"), findTxt(d1, "slotId", "WRIST",        "itemRarity")));
                setChildren(seq, "GRP_BG_RING",         mkBuffA(findTxt(d1, "slotId", "RING",       "itemName"), findTxt(d1, "slotId", "RING",         "itemRarity")));
                setChildren(seq, "GRP_BG_SUPPORT",      mkBuffA(findTxt(d1, "slotId", "SUPPORT",    "itemName"), findTxt(d1, "slotId", "SUPPORT",      "itemRarity")));
                setChildren(seq, "GRP_BG_MAGIC_STON",   mkBuffA(findTxt(d1, "slotId", "MAGIC_STON", "itemName"), findTxt(d1, "slotId", "MAGIC_STON",   "itemRarity")));
                setChildren(seq, "GRP_BG_EARRING",      mkBuffA(findTxt(d1, "slotId", "EARRING",    "itemName"), findTxt(d1, "slotId", "EARRING",      "itemRarity")));

                searchBuffB(seq, serverName, characterId, opt);
            }
        }

        function searchBuffB(seq, serverName, characterId, opt){
            var url = "https://api.neople.co.kr/df/servers/";
            url += transServer(seq, serverName);
            url += "/characters/";
            url += characterId;
            url += "/skill/buff/equip/avatar?apikey=";
            url += document.getElementById("ipbApikey").value;

            var request = new XMLHttpRequest();
            request.open('GET', url, true);
            request.send();
            request.onload = function () {
                var a1 = JSON.parse(request.response);
                var b1 = a1.skill;
                var c1 = b1.buff;
                var d1 = c1.avatar;

                var buffName = c1.skillInfo;
                    buffName = buffName.name;

                setChildren(seq, "GRP_BG_JACKET_A",     mkBuffB(findTxt(d1, "slotId", "JACKET", "emblems"), findTxt(d1, "slotId", "JACKET", "optionAbility"), buffName));
                setChildren(seq, "GRP_BG_PANTS_A",      mkBuffB(findTxt(d1, "slotId", "PANTS",  "emblems"), null,                                             buffName));

                searchBuffC(seq, serverName, characterId, opt);
            }
        }

        function searchBuffC(seq, serverName, characterId, opt){
            var url = "https://api.neople.co.kr/df/servers/";
            url += transServer(seq, serverName);
            url += "/characters/";
            url += characterId;
            url += "/skill/buff/equip/creature?apikey=";
            url += document.getElementById("ipbApikey").value;

            var request = new XMLHttpRequest();
            request.open('GET', url, true);
            request.send();
            request.onload = function () {
                var a1 = JSON.parse(request.response);

                setChildren(seq, "GRP_BG_CREATURE",     mkBuffC(a1.skill));
            }
        }
    </script>
</head>
<body onload="init();">
<div style="height: 60px;">
    <h1>던파용병단</h1>
</div>
<div class="header" style="display: none;">
    <div style="width: 100px;">APIKEY</div>
    <div style="flex-grow: 1"><input id="ipbApikey" style="" type="text" placeholder=""></div>
</div>

<div class="header">
    <div style="width: 100px;">서버</div>
    <div style="width: 130px;">
        <select id="cmbServer" style="width: 100%; height: 30px">
            <option value="prey">프레이</option>
            <option value="cain">카인</option>
            <option value="diregie">디레지에</option>
            <option value="siroco">시로코</option>
            <option value="casillas">카시야스</option>
            <option value="hilder">힐더</option>
            <option value="anton">안톤</option>
            <option value="bakal">바칼</option>
        </select>
    </div>
    <div style="width: 100px">캐릭터명</div>
    <div style="flex-grow: 1;"><input type="text" id="ipbCharNm" style="width: 100%" placeholder="캐릭터명을 공백으로 구분해주세요.ex)퇴마사 어벤져 크리에이터"></div>
    <div style=""><button type="button" style="height: 100%;" onclick="onclick_add()">추가</button> </div>
    <div style=""><button type="button" style="height: 100%;" onclick="onclick_doSearch()">조회</button> </div>
</div>
<!--<div>-->
<!--    <div><input type="text" id="ipbAdvenName" style="width: 300px;"><button type="button">dd</button></div>-->
<!--</div>-->

<div id="tab">
    <div class="tab_row">
        <button class="tab_btn tab_if" type="button" id="TAB_BTN_IF_A" onclick="onclick_tab('GRP_IF', 'A');">기본정보</button>
    </div>
    <div class="tab_row">
        <button class="tab_btn tab_kj" type="button" id="TAB_BTN_KJ_A" onclick="onclick_tab('GRP_KJ', 'A');">강화/증폭<br>무기/방어구</button>
    </div>
    <div class="tab_row">
        <button class="tab_btn tab_kj" type="button" id="TAB_BTN_KJ_B" onclick="onclick_tab('GRP_KJ', 'B');">강화/증폭<br>악세/특장</button>
    </div>
    <div class="tab_row">
        <button class="tab_btn tab_uk" type="button" id="TAB_BTN_UK_A" onclick="onclick_tab('GRP_UK', 'A');">융합석[각인]<br>무기/방어구</button>
    </div>
    <div class="tab_row">
        <button class="tab_btn tab_uk" type="button" id="TAB_BTN_UK_B" onclick="onclick_tab('GRP_UK', 'B');">융합석[각인]<br>악세/특장</button>
    </div>
    <div class="tab_row">
        <button class="tab_btn tab_mb" type="button" id="TAB_BTN_MB_A" onclick="onclick_tab('GRP_MB', 'A');">마법부여<br>무기/방어구</button>
    </div>
    <div class="tab_row">
        <button class="tab_btn tab_mb" type="button" id="TAB_BTN_MB_B" onclick="onclick_tab('GRP_MB', 'B');">마법부여<br>악세/특장</button>
    </div>
    <div class="tab_row">
        <button class="tab_btn tab_av" type="button" id="TAB_BTN_AV_A" onclick="onclick_tab('GRP_AV', 'A');">아바타</button>
    </div>
    <div class="tab_row">
        <button class="tab_btn tab_cr" type="button" id="TAB_BTN_CR_A" onclick="onclick_tab('GRP_CR', 'A');">크리쳐</button>
    </div>
    <div class="tab_row">
        <button class="tab_btn tab_bg" type="button" id="TAB_BTN_BG_A" onclick="onclick_tab('GRP_BG', 'A');">버프강화</button>
    </div>
    <div class="tab_row">
        <button class="tab_btn tab_sp" type="button" id="TAB_BTN_SP_A" onclick="onclick_tab('GRP_SP', 'A');">시에오칭</button>
    </div>
    <div class="tab_row">
        <button class="tab_btn tab_sp" type="button" id="TAB_BTN_SP_B" onclick="onclick_tab('GRP_SP', 'B');">딜플티</button>
    </div>
</div>

<div class="contents" id="contents01">
    <!--샘플 시작-->
<!--    <div class="tb_col"  id='GRP_SM_SAMPLE' style="">-->
<!--        <script>-->
<!--            document.write("<div class='tb_header' style='height: 30px;'>" + "샘플" + "</div>");-->
<!--            for (var i = 0; i < 20; i++) {-->
<!--                document.write("<div class='tb_body' style='height: 30px;'>" + Number(i + 1) + "</div>");-->

<!--            }-->
<!--        </script>-->
<!--    </div>-->
    <!--샘플 시작-->

    <!--고정부분 시작-->
    <div class="tb_col GRP_FX_A" id="GRP_FX_SEQ" style="">
        <div class="tb_header">순번</div>
    </div>
    <div class="tb_col GRP_FX_A" id="GRP_FX_SERVER" style="">
        <div class="tb_header">서버</div>
    </div>
    <div class="tb_col GRP_FX_A" id="GRP_FX_CHARNM" style="">
        <div class="tb_header">캐릭터명</div>
    </div>
    <!--고정부분 끝-->

    <!--기본정보 시작-->
    <div class="tb_col GRP_IF_A" id="GRP_IF_JOB" style="">
        <div class="tb_header">직업</div>
    </div>
    <div class="tb_col GRP_IF_A" id="GRP_IF_FAME" style="">
        <div class="tb_header">명성</div>
    </div>
    <div class="tb_col GRP_IF_A" id="GRP_IF_CODE" style="width: 400px;">
        <div class="tb_header">고유코드</div>
    </div>
    <!--기본정보 끝-->

    <!--강화/증폭-무기/방어구 시작-->
    <div class="tb_col GRP_KJ_A" id="GRP_KJ_WEAPON" style="">
        <div class="tb_header">무기</div>
    </div>
    <div class="tb_col GRP_KJ_A" id="GRP_KJ_JACKET" style="">
        <div class="tb_header">상의</div>
    </div>
    <div class="tb_col GRP_KJ_A" id="GRP_KJ_SHOULDER" style="">
        <div class="tb_header">머리어깨</div>
    </div>
    <div class="tb_col GRP_KJ_A" id="GRP_KJ_PANTS" style="">
        <div class="tb_header">하의</div>
    </div>
    <div class="tb_col GRP_KJ_A" id="GRP_KJ_SHOES" style="">
        <div class="tb_header">신발</div>
    </div>
    <div class="tb_col GRP_KJ_A" id="GRP_KJ_WAIST" style="">
        <div class="tb_header">벨트</div>
    </div>
    <!--강화/증폭-무기/방어구 끝-->

    <!--강화/증폭-악세/특장 시작-->
    <div class="tb_col GRP_KJ_B" id="GRP_KJ_AMULET" style="">
        <div class="tb_header">목걸이</div>
    </div>
    <div class="tb_col GRP_KJ_B" id="GRP_KJ_WRIST" style="">
        <div class="tb_header">팔찌</div>
    </div>
    <div class="tb_col GRP_KJ_B" id="GRP_KJ_RING" style="">
        <div class="tb_header">반지</div>
    </div>
    <div class="tb_col GRP_KJ_B" id="GRP_KJ_SUPPORT" style="">
        <div class="tb_header">보조장비</div>
    </div>
    <div class="tb_col GRP_KJ_B" id="GRP_KJ_MAGIC_STON" style="">
        <div class="tb_header">마법석</div>
    </div>
    <div class="tb_col GRP_KJ_B" id="GRP_KJ_EARRING" style="">
        <div class="tb_header">귀걸이</div>
    </div>
    <!--강화/증폭-악세/특장 끝-->

    <!--융합석[각인]-방어구 시작-->
    <div class="tb_col GRP_UK_A" id="GRP_UK_WEAPON" style="">
        <div class="tb_header">무기</div>
    </div>
    <div class="tb_col GRP_UK_A" id="GRP_UK_JACKET" style="">
        <div class="tb_header">상의</div>
    </div>
    <div class="tb_col GRP_UK_A" id="GRP_UK_SHOULDER" style="">
        <div class="tb_header">머리어깨</div>
    </div>
    <div class="tb_col GRP_UK_A" id="GRP_UK_PANTS" style="">
        <div class="tb_header">하의</div>
    </div>
    <div class="tb_col GRP_UK_A" id="GRP_UK_SHOES" style="">
        <div class="tb_header">신발</div>
    </div>
    <div class="tb_col GRP_UK_A" id="GRP_UK_WAIST" style="">
        <div class="tb_header">벨트</div>
    </div>
    <!--융합석[각인]-방어구 끝-->

    <!--융합석[각인]-악세/특장 시작-->
    <div class="tb_col GRP_UK_B" id="GRP_UK_AMULET" style="">
        <div class="tb_header">목걸이</div>
    </div>
    <div class="tb_col GRP_UK_B" id="GRP_UK_WRIST" style="">
        <div class="tb_header">팔찌</div>
    </div>
    <div class="tb_col GRP_UK_B" id="GRP_UK_RING" style="">
        <div class="tb_header">반지</div>
    </div>
    <div class="tb_col GRP_UK_B" id="GRP_UK_SUPPORT" style="">
        <div class="tb_header">보조장비</div>
    </div>
    <div class="tb_col GRP_UK_B" id="GRP_UK_MAGIC_STON" style="">
        <div class="tb_header">마법석</div>
    </div>
    <div class="tb_col GRP_UK_B" id="GRP_UK_EARRING" style="">
        <div class="tb_header">귀걸이</div>
    </div>
    <!--융합석[각인]-악세/특장 끝-->

    <!--마법부여-무기/방어구 시작-->
    <div class="tb_col GRP_MB_A" id="GRP_MB_WEAPON" style="">
        <div class="tb_header">무기</div>
    </div>
    <div class="tb_col GRP_MB_A" id="GRP_MB_JACKET" style="">
        <div class="tb_header">상의</div>
    </div>
    <div class="tb_col GRP_MB_A" id="GRP_MB_SHOULDER" style="">
        <div class="tb_header">머리어깨</div>
    </div>
    <div class="tb_col GRP_MB_A" id="GRP_MB_PANTS" style="">
        <div class="tb_header">하의</div>
    </div>
    <div class="tb_col GRP_MB_A" id="GRP_MB_SHOES" style="">
        <div class="tb_header">신발</div>
    </div>
    <div class="tb_col GRP_MB_A" id="GRP_MB_WAIST" style="">
        <div class="tb_header">벨트</div>
    </div>
    <!--마법부여-방어구 끝-->

    <!--마법부여-악세/특장 시작-->
    <div class="tb_col GRP_MB_B" id="GRP_MB_AMULET" style="">
        <div class="tb_header">목걸이</div>
    </div>
    <div class="tb_col GRP_MB_B" id="GRP_MB_WRIST" style="">
        <div class="tb_header">팔찌</div>
    </div>
    <div class="tb_col GRP_MB_B" id="GRP_MB_RING" style="">
        <div class="tb_header">반지</div>
    </div>
    <div class="tb_col GRP_MB_B" id="GRP_MB_SUPPORT" style="">
        <div class="tb_header">보조장비</div>
    </div>
    <div class="tb_col GRP_MB_B" id="GRP_MB_MAGIC_STON" style="">
        <div class="tb_header">마법석</div>
    </div>
    <div class="tb_col GRP_MB_B" id="GRP_MB_EARRING" style="">
        <div class="tb_header">귀걸이</div>
    </div>
    <div class="tb_col GRP_MB_B" id="GRP_MB_TITLE" style="">
        <div class="tb_header">칭호</div>
    </div>
    <!--마법부여-악세/특장 끝-->

    <!--아바타 시작-->
    <div class="tb_col GRP_AV_A" id="GRP_AV_HEADGEAR" style="">
        <div class="tb_header">모자</div>
    </div>
    <div class="tb_col GRP_AV_A" id="GRP_AV_HAIR" style="">
        <div class="tb_header">머리</div>
    </div>
    <div class="tb_col GRP_AV_A" id="GRP_AV_FACE" style="">
        <div class="tb_header">얼굴</div>
    </div>
    <div class="tb_col GRP_AV_A" id="GRP_AV_JACKET" style="">
        <div class="tb_header">상의</div>
    </div>
    <div class="tb_col GRP_AV_A" id="GRP_AV_PANTS" style="">
        <div class="tb_header">하의</div>
    </div>
    <div class="tb_col GRP_AV_A" id="GRP_AV_SHOES" style="">
        <div class="tb_header">신발</div>
    </div>
    <div class="tb_col GRP_AV_A" id="GRP_AV_BREAST" style="">
        <div class="tb_header">목가슴</div>
    </div>
    <div class="tb_col GRP_AV_A" id="GRP_AV_WAIST" style="">
        <div class="tb_header">허리</div>
    </div>
    <div class="tb_col GRP_AV_A" id="GRP_AV_SKIN" style="">
        <div class="tb_header">스킨</div>
    </div>
    <div class="tb_col GRP_AV_A" id="GRP_AV_AURORA" style="">
        <div class="tb_header">오라</div>
    </div>
    <div class="tb_col GRP_AV_A" id="GRP_AV_WEAPON" style="">
        <div class="tb_header">무기</div>
    </div>
    <div class="tb_col GRP_AV_A" id="GRP_AV_AURA_SKIN" style="">
        <div class="tb_header">오라 스킨</div>
    </div>
    <!--아바타 끝-->

    <!--크리쳐 시작-->
    <div class="tb_col GRP_CR_A" id="GRP_CR_CREATURE" style="">
        <div class="tb_header">크리쳐</div>
    </div>
    <div class="tb_col GRP_CR_A" id="GRP_CR_RED_ARTIFACT" style="">
        <div class="tb_header">레드아티팩트</div>
    </div>
    <div class="tb_col GRP_CR_A" id="GRP_CR_BLUE_ARTIFACT" style="">
        <div class="tb_header">블루아티팩트</div>
    </div>
    <div class="tb_col GRP_CR_A" id="GRP_CR_GREEN_ARTIFACT" style="">
        <div class="tb_header">그린아티팩트</div>
    </div>
    <div class="tb_col GRP_CR_A" id="GRP_CR_CREATURE_CLONE" style="">
        <div class="tb_header">크리쳐스킨</div>
    </div>
    <!--크리쳐 끝-->

    <!--버프강화 시작-->
    <div class="tb_col GRP_BG_A" id="GRP_BG_WEAPON" style="">
        <div class="tb_header">무기</div>
    </div>
    <div class="tb_col GRP_BG_A" id="GRP_BG_JACKET" style="">
        <div class="tb_header">상의</div>
    </div>
    <div class="tb_col GRP_BG_A" id="GRP_BG_SHOULDER" style="">
        <div class="tb_header">머리어깨</div>
    </div>
    <div class="tb_col GRP_BG_A" id="GRP_BG_PANTS" style="">
        <div class="tb_header">하의</div>
    </div>
    <div class="tb_col GRP_BG_A" id="GRP_BG_SHOES" style="">
        <div class="tb_header">신발</div>
    </div>
    <div class="tb_col GRP_BG_A" id="GRP_BG_WAIST" style="">
        <div class="tb_header">벨트</div>
    </div>
    <div class="tb_col GRP_BG_A" id="GRP_BG_AMULET" style="">
        <div class="tb_header">목걸이</div>
    </div>
    <div class="tb_col GRP_BG_A" id="GRP_BG_WRIST" style="">
        <div class="tb_header">팔찌</div>
    </div>
    <div class="tb_col GRP_BG_A" id="GRP_BG_RING" style="">
        <div class="tb_header">반지</div>
    </div>
    <div class="tb_col GRP_BG_A" id="GRP_BG_SUPPORT" style="">
        <div class="tb_header">보조장비</div>
    </div>
    <div class="tb_col GRP_BG_A" id="GRP_BG_MAGIC_STON" style="">
        <div class="tb_header">마법석</div>
    </div>
    <div class="tb_col GRP_BG_A" id="GRP_BG_EARRING" style="">
        <div class="tb_header">귀걸이</div>
    </div>
    <div class="tb_col GRP_BG_A" id="GRP_BG_TITLE" style="">
        <div class="tb_header">칭호</div>
    </div>
    <div class="tb_col GRP_BG_A" id="GRP_BG_JACKET_A" style="">
        <div class="tb_header">아바타 상의</div>
    </div>
    <div class="tb_col GRP_BG_A" id="GRP_BG_PANTS_A" style="">
        <div class="tb_header">아바타 하의</div>
    </div>
    <div class="tb_col GRP_BG_A" id="GRP_BG_CREATURE" style="">
        <div class="tb_header">크리쳐</div>
    </div>
    <!--버프강화 끝-->
</div>


<!--강화/증폭-악세/특장 시작-->
<!--강화/증폭-악세/특장 끝-->
<!--강화/증폭-악세/특장 시작-->
<!--강화/증폭-악세/특장 끝-->
<!--강화/증폭-악세/특장 시작-->
<!--강화/증폭-악세/특장 끝-->


<!--</div>-->


</body>
</html>